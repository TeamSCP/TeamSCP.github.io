<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="FSB" /><meta name="author" content="심재훈" /><meta property="og:locale" content="en" /><meta name="description" content="Format String Bug Format String Format String이란 데이터의 형식을 정해주는 지정해주는 문자열이다. Format String Type Meaning %d int 정수 %f float 실수 %c char 문자 %s string 문자열 %u decimal 10진수 %x hexadecimal 16진수 %n int 출력된 문자의 개수 아래와 같이 printf 함수에서 자주 볼 수 있다. 1 2 3 4 5 // 1번 printf(&quot;%d&quot;, number); // 2번 printf(number); 위 두 코드는 number 변수를 출력하는 같은 기능을 수행하는 코드이다. 코드만 보았을 때 두 코드에 차이점은 Format String 사용 여부이다.그렇다면 좀 더 코드 길이가 짧은 2번 코드가 좋은 코드라고 생각할 수 있다. 하지만 2번 코드는 FSB 취약점을 가지고 있다. printf 함수 printf 함수의 원형을 보자 1 2 3 #include &lt;stdio.h&gt; int printf(const char * restrict format, ...); 인자로 Format이 들어가는 것을 알 수 있다. 만약 Format을 정하지 않으면 어떻게 될까?간단한 코드를 통해 확인해보자. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // printf_test.c #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;string.h&gt; int main(int argc, char **argv){ char buf[100]; if(argc != 2) return 0; strcpy(buf, argv[1]); printf(buf); printf(&quot;\n&quot;); return 0; } 입력받은 두 번째 인자를 buf에 복사하고 출력하는 코드이다.abc를 입력해보자. printf 함수에 Format을 정하지 않았지만, 출력은 문제없이 작동한다. 이번에는 Format String을 입력해보자. 오류는 일어나지 않았지만 %x를 사용해 변수와 상관없이 Stack에서 4byte만큼 pop해서 출력된 것을 볼 수 있다. AAAA를 입력 후 %x를 8번 출력했을 때 0x41414141 즉, AAAA가 저장되어있는 buf 배열인 것을 알 수 있다. 또한 printf 함수의 인자와 buf 배열에 거리가 %x * 7 = 28byte인 것을 알 수 있다. Format String Bug ( FSB ) Format String을 통해 현재 메모리 주소와 원하는 메모리 주소 등 메모리 구조를 추측할 수 있다. 이를 통해 공격자들은 Format String Bug을 통해 메모리를 보거나 변조한다. 메모리 변조를 위해서는 변조할 주소와 변조를 통해 이동할 주소를 알아야 한다. 변조할 주소는 Debugging이나 Format String을 이용해 알아낼 수 있다. 변조를 통해 이동할 주소 즉, RET 주소는 Debugging이나 환경변수를 통해 알아낼 수 있다. 워게임으로 Format String Bug를 실습해보자. 실습 환경 가상머신 : VMware workstation iso : exploit-exercises-protostar-2 ID : user PW : user 워게임 : Protostar 문제 : format2 로그인 후 셸을 실행시켜준다. 문제를 풀기 위해 /opt/protostar/bin 디렉터리로 이동하자. format2 문제를 풀어보자. 우선 파일을 Debugging 하기 위해 tmp 디렉터리로 복사 후 이동하자. gdb를 통해 format2 파일을 Debugging 해보자. main 함수를 disassemble 해봤지만, vuln 함수 호출 외에 다른 코드가 없는 것을 보니 vuln 함수를 보도록 하자. vuln 함수는 입력받은 값을 512byte 변수에 저장하고 변수를 출력 후 0x80496e4 값이 64가 아니면 0x80496e4 값을 포함해 출력하고, 64가 맞다면 문자열만 출력한다. 코드를 확인해보면 0x80496e4가 변조해야 할 target 변수에 주소인 것을 알 수 있다. 다음으로는 %x를 이용해 printf와 buffer 사이 거리를 구해보자. %x를 4번 출력했을 때 buffer 배열이 나온다. printf와 buffer 사이 거리는 24byte인 것을 알 수 있다. 이제 거리와 주소를 알아냈으니 FSB를 통해 target 변수를 변조해보자. 메모리를 볼 때는 %x를 이용했다. 메모리를 변조할 때는 %n을 이용할 것이다. %n은 출력된 바이트 수를 지정된 변수에 저장하는 Format String이다. %n을 사용해 target 변수에 주소가 들어있는 배열에 64를 저장하면 문제를 해결할 수 있다. target 변수가 변조되어 출력되는 것을 확인할 수 있다. 하지만 64가 아니라 문제가 해결되지는 않았다. 1byte를 출력하는 Format String인 %c를 이용해보자. target 변수가 64로 변조되어 문제가 해결된 것을 볼 수 있다. 마무리하며 Format String Bug는 메모리를 볼 수 있고, 메모리를 변조할 수 있어 다양한 공격에 활용될 수 있다. 대응 방안으로는 FSB는 Format을 정해주지 않아서 발생하는 취약점이므로 코드를 작성할 때 정확한 Format String 지정이 필요하다. 참고 포맷스트링 공격(Format String Attack) - eli_ez3r Hacking Blog 작은 실수에서 오는 취약점, 포맷 스트링 - Knowllipop 놀리팝 Format Two :: Andrew Griffiths’ Exploit Education" /><meta property="og:description" content="Format String Bug Format String Format String이란 데이터의 형식을 정해주는 지정해주는 문자열이다. Format String Type Meaning %d int 정수 %f float 실수 %c char 문자 %s string 문자열 %u decimal 10진수 %x hexadecimal 16진수 %n int 출력된 문자의 개수 아래와 같이 printf 함수에서 자주 볼 수 있다. 1 2 3 4 5 // 1번 printf(&quot;%d&quot;, number); // 2번 printf(number); 위 두 코드는 number 변수를 출력하는 같은 기능을 수행하는 코드이다. 코드만 보았을 때 두 코드에 차이점은 Format String 사용 여부이다.그렇다면 좀 더 코드 길이가 짧은 2번 코드가 좋은 코드라고 생각할 수 있다. 하지만 2번 코드는 FSB 취약점을 가지고 있다. printf 함수 printf 함수의 원형을 보자 1 2 3 #include &lt;stdio.h&gt; int printf(const char * restrict format, ...); 인자로 Format이 들어가는 것을 알 수 있다. 만약 Format을 정하지 않으면 어떻게 될까?간단한 코드를 통해 확인해보자. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // printf_test.c #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;string.h&gt; int main(int argc, char **argv){ char buf[100]; if(argc != 2) return 0; strcpy(buf, argv[1]); printf(buf); printf(&quot;\n&quot;); return 0; } 입력받은 두 번째 인자를 buf에 복사하고 출력하는 코드이다.abc를 입력해보자. printf 함수에 Format을 정하지 않았지만, 출력은 문제없이 작동한다. 이번에는 Format String을 입력해보자. 오류는 일어나지 않았지만 %x를 사용해 변수와 상관없이 Stack에서 4byte만큼 pop해서 출력된 것을 볼 수 있다. AAAA를 입력 후 %x를 8번 출력했을 때 0x41414141 즉, AAAA가 저장되어있는 buf 배열인 것을 알 수 있다. 또한 printf 함수의 인자와 buf 배열에 거리가 %x * 7 = 28byte인 것을 알 수 있다. Format String Bug ( FSB ) Format String을 통해 현재 메모리 주소와 원하는 메모리 주소 등 메모리 구조를 추측할 수 있다. 이를 통해 공격자들은 Format String Bug을 통해 메모리를 보거나 변조한다. 메모리 변조를 위해서는 변조할 주소와 변조를 통해 이동할 주소를 알아야 한다. 변조할 주소는 Debugging이나 Format String을 이용해 알아낼 수 있다. 변조를 통해 이동할 주소 즉, RET 주소는 Debugging이나 환경변수를 통해 알아낼 수 있다. 워게임으로 Format String Bug를 실습해보자. 실습 환경 가상머신 : VMware workstation iso : exploit-exercises-protostar-2 ID : user PW : user 워게임 : Protostar 문제 : format2 로그인 후 셸을 실행시켜준다. 문제를 풀기 위해 /opt/protostar/bin 디렉터리로 이동하자. format2 문제를 풀어보자. 우선 파일을 Debugging 하기 위해 tmp 디렉터리로 복사 후 이동하자. gdb를 통해 format2 파일을 Debugging 해보자. main 함수를 disassemble 해봤지만, vuln 함수 호출 외에 다른 코드가 없는 것을 보니 vuln 함수를 보도록 하자. vuln 함수는 입력받은 값을 512byte 변수에 저장하고 변수를 출력 후 0x80496e4 값이 64가 아니면 0x80496e4 값을 포함해 출력하고, 64가 맞다면 문자열만 출력한다. 코드를 확인해보면 0x80496e4가 변조해야 할 target 변수에 주소인 것을 알 수 있다. 다음으로는 %x를 이용해 printf와 buffer 사이 거리를 구해보자. %x를 4번 출력했을 때 buffer 배열이 나온다. printf와 buffer 사이 거리는 24byte인 것을 알 수 있다. 이제 거리와 주소를 알아냈으니 FSB를 통해 target 변수를 변조해보자. 메모리를 볼 때는 %x를 이용했다. 메모리를 변조할 때는 %n을 이용할 것이다. %n은 출력된 바이트 수를 지정된 변수에 저장하는 Format String이다. %n을 사용해 target 변수에 주소가 들어있는 배열에 64를 저장하면 문제를 해결할 수 있다. target 변수가 변조되어 출력되는 것을 확인할 수 있다. 하지만 64가 아니라 문제가 해결되지는 않았다. 1byte를 출력하는 Format String인 %c를 이용해보자. target 변수가 64로 변조되어 문제가 해결된 것을 볼 수 있다. 마무리하며 Format String Bug는 메모리를 볼 수 있고, 메모리를 변조할 수 있어 다양한 공격에 활용될 수 있다. 대응 방안으로는 FSB는 Format을 정해주지 않아서 발생하는 취약점이므로 코드를 작성할 때 정확한 Format String 지정이 필요하다. 참고 포맷스트링 공격(Format String Attack) - eli_ez3r Hacking Blog 작은 실수에서 오는 취약점, 포맷 스트링 - Knowllipop 놀리팝 Format Two :: Andrew Griffiths’ Exploit Education" /><link rel="canonical" href="https://teamscp.github.io/posts/FSB/" /><meta property="og:url" content="https://teamscp.github.io/posts/FSB/" /><meta property="og:site_name" content="SCP Tech Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-27T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="FSB" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@심재훈" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"심재훈"},"dateModified":"2022-08-27T00:00:00+00:00","datePublished":"2022-08-27T00:00:00+00:00","description":"Format String Bug Format String Format String이란 데이터의 형식을 정해주는 지정해주는 문자열이다. Format String Type Meaning %d int 정수 %f float 실수 %c char 문자 %s string 문자열 %u decimal 10진수 %x hexadecimal 16진수 %n int 출력된 문자의 개수 아래와 같이 printf 함수에서 자주 볼 수 있다. 1 2 3 4 5 // 1번 printf(&quot;%d&quot;, number); // 2번 printf(number); 위 두 코드는 number 변수를 출력하는 같은 기능을 수행하는 코드이다. 코드만 보았을 때 두 코드에 차이점은 Format String 사용 여부이다.그렇다면 좀 더 코드 길이가 짧은 2번 코드가 좋은 코드라고 생각할 수 있다. 하지만 2번 코드는 FSB 취약점을 가지고 있다. printf 함수 printf 함수의 원형을 보자 1 2 3 #include &lt;stdio.h&gt; int printf(const char * restrict format, ...); 인자로 Format이 들어가는 것을 알 수 있다. 만약 Format을 정하지 않으면 어떻게 될까?간단한 코드를 통해 확인해보자. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 // printf_test.c #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;string.h&gt; int main(int argc, char **argv){ char buf[100]; if(argc != 2) return 0; strcpy(buf, argv[1]); printf(buf); printf(&quot;\\n&quot;); return 0; } 입력받은 두 번째 인자를 buf에 복사하고 출력하는 코드이다.abc를 입력해보자. printf 함수에 Format을 정하지 않았지만, 출력은 문제없이 작동한다. 이번에는 Format String을 입력해보자. 오류는 일어나지 않았지만 %x를 사용해 변수와 상관없이 Stack에서 4byte만큼 pop해서 출력된 것을 볼 수 있다. AAAA를 입력 후 %x를 8번 출력했을 때 0x41414141 즉, AAAA가 저장되어있는 buf 배열인 것을 알 수 있다. 또한 printf 함수의 인자와 buf 배열에 거리가 %x * 7 = 28byte인 것을 알 수 있다. Format String Bug ( FSB ) Format String을 통해 현재 메모리 주소와 원하는 메모리 주소 등 메모리 구조를 추측할 수 있다. 이를 통해 공격자들은 Format String Bug을 통해 메모리를 보거나 변조한다. 메모리 변조를 위해서는 변조할 주소와 변조를 통해 이동할 주소를 알아야 한다. 변조할 주소는 Debugging이나 Format String을 이용해 알아낼 수 있다. 변조를 통해 이동할 주소 즉, RET 주소는 Debugging이나 환경변수를 통해 알아낼 수 있다. 워게임으로 Format String Bug를 실습해보자. 실습 환경 가상머신 : VMware workstation iso : exploit-exercises-protostar-2 ID : user PW : user 워게임 : Protostar 문제 : format2 로그인 후 셸을 실행시켜준다. 문제를 풀기 위해 /opt/protostar/bin 디렉터리로 이동하자. format2 문제를 풀어보자. 우선 파일을 Debugging 하기 위해 tmp 디렉터리로 복사 후 이동하자. gdb를 통해 format2 파일을 Debugging 해보자. main 함수를 disassemble 해봤지만, vuln 함수 호출 외에 다른 코드가 없는 것을 보니 vuln 함수를 보도록 하자. vuln 함수는 입력받은 값을 512byte 변수에 저장하고 변수를 출력 후 0x80496e4 값이 64가 아니면 0x80496e4 값을 포함해 출력하고, 64가 맞다면 문자열만 출력한다. 코드를 확인해보면 0x80496e4가 변조해야 할 target 변수에 주소인 것을 알 수 있다. 다음으로는 %x를 이용해 printf와 buffer 사이 거리를 구해보자. %x를 4번 출력했을 때 buffer 배열이 나온다. printf와 buffer 사이 거리는 24byte인 것을 알 수 있다. 이제 거리와 주소를 알아냈으니 FSB를 통해 target 변수를 변조해보자. 메모리를 볼 때는 %x를 이용했다. 메모리를 변조할 때는 %n을 이용할 것이다. %n은 출력된 바이트 수를 지정된 변수에 저장하는 Format String이다. %n을 사용해 target 변수에 주소가 들어있는 배열에 64를 저장하면 문제를 해결할 수 있다. target 변수가 변조되어 출력되는 것을 확인할 수 있다. 하지만 64가 아니라 문제가 해결되지는 않았다. 1byte를 출력하는 Format String인 %c를 이용해보자. target 변수가 64로 변조되어 문제가 해결된 것을 볼 수 있다. 마무리하며 Format String Bug는 메모리를 볼 수 있고, 메모리를 변조할 수 있어 다양한 공격에 활용될 수 있다. 대응 방안으로는 FSB는 Format을 정해주지 않아서 발생하는 취약점이므로 코드를 작성할 때 정확한 Format String 지정이 필요하다. 참고 포맷스트링 공격(Format String Attack) - eli_ez3r Hacking Blog 작은 실수에서 오는 취약점, 포맷 스트링 - Knowllipop 놀리팝 Format Two :: Andrew Griffiths’ Exploit Education","headline":"FSB","mainEntityOfPage":{"@type":"WebPage","@id":"https://teamscp.github.io/posts/FSB/"},"url":"https://teamscp.github.io/posts/FSB/"}</script><title>FSB | SCP Tech Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="mask-icon" href="/assets/img/favicons/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/favicons/SCP_%EB%9D%BC%EC%9D%B83-big.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">SCP Tech Blog</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/TeamSCP" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.facebook.com/HackingTeamSCP" aria-label="facebook" target="_blank" rel="noopener"> <i class="fab fa-facebook"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>FSB</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>FSB</h1><div class="post-meta text-muted"><div> By <em> 심재훈 </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1661558400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-08-27 </em> </span> <span> Updated <em class="timeago" data-ts="1661558400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-08-27 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1290 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h1 id="format-string-bug"><strong>Format String Bug</strong></h1><h2 id="format-string"><span class="mr-2"><strong>Format String</strong></span><a href="#format-string" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><br />Format String이란 <strong>데이터의 형식을 정해주는 지정해주는 문자열</strong>이다.<br /><br /></p><div class="table-wrapper"><table><thead><tr><th style="text-align: center">Format String<th style="text-align: center">Type<th style="text-align: center">Meaning<tbody><tr><td style="text-align: center">%d<td style="text-align: center">int<td style="text-align: center">정수<tr><td style="text-align: center">%f<td style="text-align: center">float<td style="text-align: center">실수<tr><td style="text-align: center">%c<td style="text-align: center">char<td style="text-align: center">문자<tr><td style="text-align: center">%s<td style="text-align: center">string<td style="text-align: center">문자열<tr><td style="text-align: center">%u<td style="text-align: center">decimal<td style="text-align: center">10진수<tr><td style="text-align: center">%x<td style="text-align: center">hexadecimal<td style="text-align: center">16진수<tr><td style="text-align: center">%n<td style="text-align: center">int<td style="text-align: center">출력된 문자의 개수</table></div><p><br />아래와 같이 printf 함수에서 자주 볼 수 있다.<br /><br /></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>// 1번
printf("%d", number);

// 2번
printf(number);
</pre></table></code></div></div><p><br />위 두 코드는 number 변수를 출력하는 같은 기능을 수행하는 코드이다.</p><p><br />코드만 보았을 때 두 코드에 차이점은 Format String 사용 여부이다.<br />그렇다면 좀 더 코드 길이가 짧은 2번 코드가 좋은 코드라고 생각할 수 있다.</p><p><br />하지만 2번 코드는 <strong>FSB 취약점</strong>을 가지고 있다.<br /><br /></p><hr /><p><br /></p><h2 id="printf-함수"><span class="mr-2"><strong>printf 함수</strong></span><a href="#printf-함수" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><br />printf 함수의 원형을 보자<br /><br /></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>#include &lt;stdio.h&gt;

int printf(const char * restrict format, ...);
</pre></table></code></div></div><p><br />인자로 Format이 들어가는 것을 알 수 있다.<br /> <br />만약 Format을 정하지 않으면 어떻게 될까?<br />간단한 코드를 통해 확인해보자.<br /><br /></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>// printf_test.c

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;

int main(int argc, char **argv){

        char buf[100];

        if(argc != 2)
        	return 0;
 
        strcpy(buf, argv[1]);
        printf(buf);
        printf("\n");
 
        return 0;
}
</pre></table></code></div></div><p><br />입력받은 두 번째 인자를 buf에 복사하고 출력하는 코드이다.<br />abc를 입력해보자.<br /><br /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 100'%3E%3C/svg%3E" width="800" height="100" alt="1" data-src="https://user-images.githubusercontent.com/78866959/187025524-ed5b3b3b-ba55-4f9a-a473-cde5cca91bab.png" data-proofer-ignore></p><p><br />printf 함수에 Format을 정하지 않았지만, 출력은 문제없이 작동한다. <br />이번에는 Format String을 입력해보자. <br /><br /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 100'%3E%3C/svg%3E" width="800" height="100" alt="2" data-src="https://user-images.githubusercontent.com/78866959/187025635-1da3c299-ab69-465c-9766-67ecfde9b961.png" data-proofer-ignore></p><p><br />오류는 일어나지 않았지만 %x를 사용해 변수와 상관없이 Stack에서 4byte만큼 pop해서 출력된 것을 볼 수 있다.<br /><br /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 100'%3E%3C/svg%3E" width="800" height="100" alt="3" data-src="https://user-images.githubusercontent.com/78866959/187025674-5b283fa0-378b-4f09-88cf-433a3981bef6.png" data-proofer-ignore></p><p><br />AAAA를 입력 후 %x를 8번 출력했을 때 0x41414141 즉, AAAA가 저장되어있는 buf 배열인 것을 알 수 있다. <br />또한 printf 함수의 인자와 buf 배열에 거리가 %x * 7 = 28byte인 것을 알 수 있다.<br /><br /></p><hr /><h2 id="format-string-bug--fsb-"><span class="mr-2"><strong>Format String Bug ( FSB )</strong></span><a href="#format-string-bug--fsb-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><br />Format String을 통해 현재 메모리 주소와 원하는 메모리 주소 등 메모리 구조를 추측할 수 있다. <br />이를 통해 공격자들은 Format String Bug을 통해 메모리를 보거나 변조한다.</p><p><br />메모리 변조를 위해서는 변조할 주소와 변조를 통해 이동할 주소를 알아야 한다. <br />변조할 주소는 Debugging이나 Format String을 이용해 알아낼 수 있다. <br />변조를 통해 이동할 주소 즉, RET 주소는 Debugging이나 환경변수를 통해 알아낼 수 있다.</p><p><br />워게임으로 Format String Bug를 실습해보자.<br /><br /></p><blockquote><p><strong>실습 환경</strong> <br /><br />가상머신 : VMware workstation <br /> iso : exploit-exercises-protostar-2 <br /> ID : user <br /> PW : user <br /> 워게임 : Protostar <br /> 문제 : format2</p></blockquote><p><br />로그인 후 셸을 실행시켜준다.<br /><br /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" width="800" height="500" alt="4" data-src="https://user-images.githubusercontent.com/78866959/187028244-519efeac-c1b7-4251-9493-92b46a408f88.png" data-proofer-ignore></p><p><br />문제를 풀기 위해 /opt/protostar/bin 디렉터리로 이동하자.<br /><br /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 100'%3E%3C/svg%3E" width="800" height="100" alt="5" data-src="https://user-images.githubusercontent.com/78866959/187028292-06f38029-8b84-4371-a7cc-307f55e93a4d.png" data-proofer-ignore></p><p><br />format2 문제를 풀어보자. <br />우선 파일을 Debugging 하기 위해 tmp 디렉터리로 복사 후 이동하자.<br /><br /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 100'%3E%3C/svg%3E" width="800" height="100" alt="6" data-src="https://user-images.githubusercontent.com/78866959/187028310-b1b51ee6-76a8-4293-8df7-9fa74143a26f.png" data-proofer-ignore></p><p><br />gdb를 통해 format2 파일을 Debugging 해보자.<br /><br /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" width="800" height="500" alt="7" data-src="https://user-images.githubusercontent.com/78866959/187028311-4edc4277-9343-4b0d-8bfe-4a739140810c.png" data-proofer-ignore></p><p><br />main 함수를 disassemble 해봤지만, vuln 함수 호출 외에 다른 코드가 없는 것을 보니 vuln 함수를 보도록 하자.<br /><br /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" width="800" height="500" alt="8" data-src="https://user-images.githubusercontent.com/78866959/187028313-ecb43d1c-ea54-4da1-aed9-258a8fda79a4.png" data-proofer-ignore></p><p><br />vuln 함수는 입력받은 값을 512byte 변수에 저장하고 변수를 출력 후 0x80496e4 값이 64가 아니면 0x80496e4 값을 포함해 출력하고, 64가 맞다면 문자열만 출력한다.<br /><br /> <a href="https://exploit.education/protostar/format-two/"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 400'%3E%3C/svg%3E" width="400" height="400" alt="9" data-src="https://user-images.githubusercontent.com/78866959/187028315-1b399f6c-3549-48ea-af0b-c0e5cd669922.png" data-proofer-ignore></a></p><p><br />코드를 확인해보면 0x80496e4가 변조해야 할 target 변수에 주소인 것을 알 수 있다.</p><p><br />다음으로는 %x를 이용해 printf와 buffer 사이 거리를 구해보자.<br /><br /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 100'%3E%3C/svg%3E" width="800" height="100" alt="10" data-src="https://user-images.githubusercontent.com/78866959/187028317-523b72ee-b3c3-407e-8a95-74964954604c.png" data-proofer-ignore></p><p><br />%x를 4번 출력했을 때 buffer 배열이 나온다. <br />printf와 buffer 사이 거리는 24byte인 것을 알 수 있다.</p><p><br />이제 거리와 주소를 알아냈으니 FSB를 통해 target 변수를 변조해보자.</p><p><br />메모리를 볼 때는 %x를 이용했다. <br />메모리를 변조할 때는 %n을 이용할 것이다. <br />%n은 출력된 바이트 수를 지정된 변수에 저장하는 Format String이다. <br />%n을 사용해 target 변수에 주소가 들어있는 배열에 64를 저장하면 문제를 해결할 수 있다.<br /><br /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 100'%3E%3C/svg%3E" width="800" height="100" alt="11" data-src="https://user-images.githubusercontent.com/78866959/187028319-d51b5123-7499-4822-b29d-2de31743dc5f.png" data-proofer-ignore></p><p><br />target 변수가 변조되어 출력되는 것을 확인할 수 있다. <br />하지만 64가 아니라 문제가 해결되지는 않았다. <br />1byte를 출력하는 Format String인 %c를 이용해보자.<br /><br /></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 100'%3E%3C/svg%3E" width="800" height="100" alt="12" data-src="https://user-images.githubusercontent.com/78866959/187028309-5d512a6e-5c65-4db7-9192-02037de66803.png" data-proofer-ignore></p><p><br />target 변수가 64로 변조되어 문제가 해결된 것을 볼 수 있다.<br /><br /></p><hr /><h2 id="마무리하며"><span class="mr-2"><strong>마무리하며</strong></span><a href="#마무리하며" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><br />Format String Bug는 메모리를 볼 수 있고, 메모리를 변조할 수 있어 다양한 공격에 활용될 수 있다. <br />대응 방안으로는 FSB는 Format을 정해주지 않아서 발생하는 취약점이므로 코드를 작성할 때 정확한 Format String 지정이 필요하다.<br /><br /></p><h1 id="참고"><strong>참고</strong></h1><p><a href="https://eliez3r.github.io/post/2018/09/04/study-system-Format-String-Attack.html">포맷스트링 공격(Format String Attack) - eli_ez3r Hacking Blog</a><br /> <a href="https://www.youtube.com/watch?v=QZzo58Fv2b4&amp;t=136s">작은 실수에서 오는 취약점, 포맷 스트링 - Knowllipop 놀리팝</a><br /> <a href="https://exploit.education/protostar/format-two/">Format Two :: Andrew Griffiths’ Exploit Education</a><br /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/pwnable/'>Pwnable</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/fsb/" class="post-tag no-text-decoration" >FSB</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=FSB - SCP Tech Blog&amp;url=https://teamscp.github.io/posts/FSB/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=FSB - SCP Tech Blog&amp;u=https://teamscp.github.io/posts/FSB/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://teamscp.github.io/posts/FSB/&amp;text=FSB - SCP Tech Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/About_SCP/">About_SCP</a><li><a href="/posts/BruteForce/">Brute Force</a><li><a href="/posts/SQL-injection/">SQL Injection </a><li><a href="/posts/Stack_Frame/">스택(Stack)과 스택 프레임(Stack Frame)</a><li><a href="/posts/FSB/">FSB</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/apihooking/">APIHooking</a> <a class="post-tag" href="/tags/bcrypt/">Bcrypt</a> <a class="post-tag" href="/tags/bitcoin/">bitcoin</a> <a class="post-tag" href="/tags/blockchain/">blockchain</a> <a class="post-tag" href="/tags/brute-force/">Brute Force</a> <a class="post-tag" href="/tags/flask/">Flask</a> <a class="post-tag" href="/tags/fsb/">FSB</a> <a class="post-tag" href="/tags/hackrf/">HackRF</a> <a class="post-tag" href="/tags/jwt/">JWT</a> <a class="post-tag" href="/tags/promotion/">promotion</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/BruteForce/"><div class="card-body"> <em class="timeago small" data-ts="1663027200" > 2022-09-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Brute Force</h3><div class="text-muted small"><p> Brute Force 이란? 영어로 Brute 는 “짐승 같은,난폭한”이라는 뜻이고, Brute Force는 “난폭한 힘,폭력”이라는 뜻으로 조합 가능한 모든 문자열을 하나씩 대입하여 암호를 해독하는 방법이다. Brute Force 장점 이론적으로 가능한 모든 경우의 수를 다 검색해 보는 것이라 정확도 100%가 항상 보장된다. 또한 브루트 포스의...</p></div></div></a></div><div class="card"> <a href="/posts/About_SCP/"><div class="card-body"> <em class="timeago small" data-ts="1662422400" > 2022-09-06 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>About_SCP</h3><div class="text-muted small"><p> About_SCP 소개말 중부대학교 SCP 동아리는 정보보호학과 유승재 교수님의 지도하의 정보보호 연구 동아리입니다. 1998년 정보보호 창업 동아리 Soul Magic으로 창설해, 2005년 Security Check Point의 약자인 S.C.P로 바꾸어 활동하고 있습니다. S.C.P는 중부대학교 고양캠퍼스 세종관 804호에 위치하고 있으며 동...</p></div></div></a></div><div class="card"> <a href="/posts/Stack_Frame/"><div class="card-body"> <em class="timeago small" data-ts="1661644800" > 2022-08-28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스택(Stack)과 스택 프레임(Stack Frame)</h3><div class="text-muted small"><p> 스택(Stack) 스택(Stack)의 개념 LIFO(Last In First Out) 또는 FILO(First In Last Out) 형태로 동작하는 선형 자료 구조 스택(Stack)의 사전적 의미는 “더미”, “쌓다”로 자료 구조의 스택도 데이터를 순차적으로 나열한 구조이다. 가장 최근에 보관한 자료를 꺼내는 방식으로 동작한다. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/WriteFile_API_hooking/" class="btn btn-outline-primary" prompt="Older"><p>메모장 WriteFile() API 후킹</p></a> <a href="/posts/SQL-injection/" class="btn btn-outline-primary" prompt="Newer"><p>SQL Injection</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="">SCP</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/apihooking/">APIHooking</a> <a class="post-tag" href="/tags/bcrypt/">Bcrypt</a> <a class="post-tag" href="/tags/bitcoin/">bitcoin</a> <a class="post-tag" href="/tags/blockchain/">blockchain</a> <a class="post-tag" href="/tags/brute-force/">Brute Force</a> <a class="post-tag" href="/tags/flask/">Flask</a> <a class="post-tag" href="/tags/fsb/">FSB</a> <a class="post-tag" href="/tags/hackrf/">HackRF</a> <a class="post-tag" href="/tags/jwt/">JWT</a> <a class="post-tag" href="/tags/promotion/">promotion</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
