<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="SQL Injection" /><meta name="author" content="이정호" /><meta property="og:locale" content="en" /><meta name="description" content="SQL Injection 1. SQL Injection 공격이란? SQL: DB에 명령 내릴 때 쓰는 언어 Injection: 삽입 임의의 SQL문을 삽입하고 실행시켜 데이터 베이스가 비정상적인 동작을 하도록 조작하는 행위이다. 2. SQL Injection 공격의 목적 1. DB에 임의의 SQL명령 실행 2. DB의 데이터를 추출 3. 인증 우회 4. DB 데이터 변조 5. 악성 파일 업로드 3. SQL Injection 공격의 종류 1. Error based SQL Injection 다양한 SQL Injection 공격 기법 중에서도 가장 많이 사용되며, 대중적으로 잘 알려진 공격 기법이다. 1 2 3 SELECT * FROM users WHERE auth = &#39;admin&#39; AND id = &#39; id &#39; 서버에서 요청을 보낸 사용자가 관리자 권한이 있는지 확인하기 위와 같은 sql문으로 확인한다고 했을 때, 권한이 admin이고 올바른 id값을 가진 사용자가 있는지 조회해 결과가 나온다면 관리자로 인정받는다. 그러나 id의 인자로 아래와 같이 삽입 된다면, 1 &#39; OR &#39;1&#39; = &#39;1 싱글쿼터와 OR 1=1 라는 구문이 WHERE절을 모두 참으로 만들어 사실상 무조건적인 admin권한을 획득하는 것 이다. 이 뿐만 아니라 1 2 3 SELECT * FROM users WHERE auth = &#39;admin&#39; AND id = &#39;&#39;; DROP TABLE users; --&#39; ’; 으로 마무리 하고, DROP TABLE users; 새구문으로 사용자 테이블을 삭제하고 – 뒷 내용을 주석 처리한다면 사용자 테이블을 전체 삭제하는 구문으로 서버 자체를 운영하지 못하게 할 수도 있는 공격 기법이다. 2. Union based SQL Injection 원래의 요청에 추가 쿼리를 삽입하여 정보를 얻어내는 기법으로 2개 이상의 쿼리를 요청하여 결과를 얻는 Union 명령어를 이용여 공격으로 하나의 테이블로 결과를 얻는다. 단, Union 하는 두 테이블의 컬럼 수가 같아야 하고, 데이터 형이 같아야 한다. 다음과 같은 게시글 검색 쿼리문에서 1 2 SELECT * FROM Board WHERE title LIKE &#39;%INPUT%&#39; OR contents &#39;%INPUT%&#39; INPUT 안에 1 &#39;UNION SELECT null,id,password FROM Users-- 를 넣어주게 되면 두 쿼리문이 합쳐져 하나의 테이블로 보여지게 된다. 즉, Board 테이블의 id, password가 게시글과 함께 화면에 나타난다. 3. Blind based SQL Injection DB로부터 특정 데이터 전달받지 않고 즉, 정보를 직접적으로 알 수 없는 상황이더라도 참과 거짓 정보만을 통해 알아내는 기법이다. 웹 서버 보안으로 인해 기존 SQL Injection 공격 기법을 통한 정보가 출력되지 않는 경우 해당 기법을 시도할 수 있다. 4. Stored Procedure based SQL Injection 일련의 쿼리들을 모아 하나의 함수처럼 사용하기 위한 기법으로 공격자는 시스템 권한을 획득 해야 하는 공격난이도가 높은 공격이지만 공격에 성공한다면, 서버에 직접적인 피해를 가할 수 있다. 공격에 사용되는 대표적인 저장 프로시저는 MS-SQL 에 있는 xp_cmdshell로 윈도우 명령어를 사용할 수 있게 된다. 4. SQL Injection 대응방안 입력값 검증 화이트리스트 방식으로 지정된 형식의 문자만 검증한다. 특수문자 등의 에러 발생 유무 확인한다. db_name()으로 DB명 추출 여부 확인한다. SQL 오류 발생시 에러 메세지 표시하지 않기 별도로 처리해주지 않을 경우 에러가 발생한 쿼리문과 함께 에러에 관한 내용을 반환한다. (이 때 테이블 명, 컬럼명, 쿼리문이 노출 될 수 있기 때문에 메세지가 표시되지 않도록 처리해 주어야 한다.) 서버 보안 최소 권한 유저로 DB를 운영한다. 목적에 따라 쿼리 권한을 수정한다. 지속적인 관리를 통해 신뢰할 수 있는 네트워크, 서버에 대해서만 접근 허용한다. 웹 방화벽을 사용한다. 5. SQL Injection 이해하기 SQL Injection 공격을 이해하기 위한 간단한 실습을 진행해보자 운영 체제는 kali linux이며, 웹 모의 해킹 실습 서버 dvwa를 통해 실습하였다. user ID를 입력하는 창이 존재한다. 1을 입력하였더니 ID가 1인 사용자의 정보가 출력되었다. 소스를 확인해보면 이 소스코드의 경우 user ID에 사용자가 입력한 값이 $id라는 변수로 들어가기 때문에 직접 입력한 값으로 인해 sql 쿼리 문이 바뀌기 때문에 이는 sql 쿼리문을 조작할 수 있다는 의미이다. 위와 같이 입력하니 테이블의 모든 정보가 출력되었다. 이는 조건문이 항상 참이 되도록 입력됐기 때문이다. 다음으로 Union을 사용해보자면 위에서 설명한 것과 같이 Union은 두 테이블의 컬럼 수가 같아야 하기 때문에 컬럼 수를 확인해보기 위해 다음과 같이 입력해본다. select 뒤의 상수 값을 주게 되면 그것을 그대로 출력시킬 수 있다고 한다. 결과를 보니 컬럼의 수가 맞지 않다는 에러가 나왔다. 이렇게 select구문의 컬럼이 2개가 사용되었다는 것을 알 수 있다고 한다. 이제 DB정보를 알아보자면 1’union select schema_name,1 from information_schema.schemata # DB명 조회와 관련된 구문이다. 다음과 같이 모든 DB이름을 확인 할 수 있다. 6. 참고 https://noirstar.tistory.com/264 https://doh-an.tistory.com/27 버그잡는해커 유튜브" /><meta property="og:description" content="SQL Injection 1. SQL Injection 공격이란? SQL: DB에 명령 내릴 때 쓰는 언어 Injection: 삽입 임의의 SQL문을 삽입하고 실행시켜 데이터 베이스가 비정상적인 동작을 하도록 조작하는 행위이다. 2. SQL Injection 공격의 목적 1. DB에 임의의 SQL명령 실행 2. DB의 데이터를 추출 3. 인증 우회 4. DB 데이터 변조 5. 악성 파일 업로드 3. SQL Injection 공격의 종류 1. Error based SQL Injection 다양한 SQL Injection 공격 기법 중에서도 가장 많이 사용되며, 대중적으로 잘 알려진 공격 기법이다. 1 2 3 SELECT * FROM users WHERE auth = &#39;admin&#39; AND id = &#39; id &#39; 서버에서 요청을 보낸 사용자가 관리자 권한이 있는지 확인하기 위와 같은 sql문으로 확인한다고 했을 때, 권한이 admin이고 올바른 id값을 가진 사용자가 있는지 조회해 결과가 나온다면 관리자로 인정받는다. 그러나 id의 인자로 아래와 같이 삽입 된다면, 1 &#39; OR &#39;1&#39; = &#39;1 싱글쿼터와 OR 1=1 라는 구문이 WHERE절을 모두 참으로 만들어 사실상 무조건적인 admin권한을 획득하는 것 이다. 이 뿐만 아니라 1 2 3 SELECT * FROM users WHERE auth = &#39;admin&#39; AND id = &#39;&#39;; DROP TABLE users; --&#39; ’; 으로 마무리 하고, DROP TABLE users; 새구문으로 사용자 테이블을 삭제하고 – 뒷 내용을 주석 처리한다면 사용자 테이블을 전체 삭제하는 구문으로 서버 자체를 운영하지 못하게 할 수도 있는 공격 기법이다. 2. Union based SQL Injection 원래의 요청에 추가 쿼리를 삽입하여 정보를 얻어내는 기법으로 2개 이상의 쿼리를 요청하여 결과를 얻는 Union 명령어를 이용여 공격으로 하나의 테이블로 결과를 얻는다. 단, Union 하는 두 테이블의 컬럼 수가 같아야 하고, 데이터 형이 같아야 한다. 다음과 같은 게시글 검색 쿼리문에서 1 2 SELECT * FROM Board WHERE title LIKE &#39;%INPUT%&#39; OR contents &#39;%INPUT%&#39; INPUT 안에 1 &#39;UNION SELECT null,id,password FROM Users-- 를 넣어주게 되면 두 쿼리문이 합쳐져 하나의 테이블로 보여지게 된다. 즉, Board 테이블의 id, password가 게시글과 함께 화면에 나타난다. 3. Blind based SQL Injection DB로부터 특정 데이터 전달받지 않고 즉, 정보를 직접적으로 알 수 없는 상황이더라도 참과 거짓 정보만을 통해 알아내는 기법이다. 웹 서버 보안으로 인해 기존 SQL Injection 공격 기법을 통한 정보가 출력되지 않는 경우 해당 기법을 시도할 수 있다. 4. Stored Procedure based SQL Injection 일련의 쿼리들을 모아 하나의 함수처럼 사용하기 위한 기법으로 공격자는 시스템 권한을 획득 해야 하는 공격난이도가 높은 공격이지만 공격에 성공한다면, 서버에 직접적인 피해를 가할 수 있다. 공격에 사용되는 대표적인 저장 프로시저는 MS-SQL 에 있는 xp_cmdshell로 윈도우 명령어를 사용할 수 있게 된다. 4. SQL Injection 대응방안 입력값 검증 화이트리스트 방식으로 지정된 형식의 문자만 검증한다. 특수문자 등의 에러 발생 유무 확인한다. db_name()으로 DB명 추출 여부 확인한다. SQL 오류 발생시 에러 메세지 표시하지 않기 별도로 처리해주지 않을 경우 에러가 발생한 쿼리문과 함께 에러에 관한 내용을 반환한다. (이 때 테이블 명, 컬럼명, 쿼리문이 노출 될 수 있기 때문에 메세지가 표시되지 않도록 처리해 주어야 한다.) 서버 보안 최소 권한 유저로 DB를 운영한다. 목적에 따라 쿼리 권한을 수정한다. 지속적인 관리를 통해 신뢰할 수 있는 네트워크, 서버에 대해서만 접근 허용한다. 웹 방화벽을 사용한다. 5. SQL Injection 이해하기 SQL Injection 공격을 이해하기 위한 간단한 실습을 진행해보자 운영 체제는 kali linux이며, 웹 모의 해킹 실습 서버 dvwa를 통해 실습하였다. user ID를 입력하는 창이 존재한다. 1을 입력하였더니 ID가 1인 사용자의 정보가 출력되었다. 소스를 확인해보면 이 소스코드의 경우 user ID에 사용자가 입력한 값이 $id라는 변수로 들어가기 때문에 직접 입력한 값으로 인해 sql 쿼리 문이 바뀌기 때문에 이는 sql 쿼리문을 조작할 수 있다는 의미이다. 위와 같이 입력하니 테이블의 모든 정보가 출력되었다. 이는 조건문이 항상 참이 되도록 입력됐기 때문이다. 다음으로 Union을 사용해보자면 위에서 설명한 것과 같이 Union은 두 테이블의 컬럼 수가 같아야 하기 때문에 컬럼 수를 확인해보기 위해 다음과 같이 입력해본다. select 뒤의 상수 값을 주게 되면 그것을 그대로 출력시킬 수 있다고 한다. 결과를 보니 컬럼의 수가 맞지 않다는 에러가 나왔다. 이렇게 select구문의 컬럼이 2개가 사용되었다는 것을 알 수 있다고 한다. 이제 DB정보를 알아보자면 1’union select schema_name,1 from information_schema.schemata # DB명 조회와 관련된 구문이다. 다음과 같이 모든 DB이름을 확인 할 수 있다. 6. 참고 https://noirstar.tistory.com/264 https://doh-an.tistory.com/27 버그잡는해커 유튜브" /><link rel="canonical" href="https://teamscp.github.io/posts/SQL-injection/" /><meta property="og:url" content="https://teamscp.github.io/posts/SQL-injection/" /><meta property="og:site_name" content="SCP Tech Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-28T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="SQL Injection" /><meta name="twitter:site" content="@" /><meta name="twitter:creator" content="@이정호" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"이정호"},"dateModified":"2022-08-28T00:00:00+00:00","datePublished":"2022-08-28T00:00:00+00:00","description":"SQL Injection 1. SQL Injection 공격이란? SQL: DB에 명령 내릴 때 쓰는 언어 Injection: 삽입 임의의 SQL문을 삽입하고 실행시켜 데이터 베이스가 비정상적인 동작을 하도록 조작하는 행위이다. 2. SQL Injection 공격의 목적 1. DB에 임의의 SQL명령 실행 2. DB의 데이터를 추출 3. 인증 우회 4. DB 데이터 변조 5. 악성 파일 업로드 3. SQL Injection 공격의 종류 1. Error based SQL Injection 다양한 SQL Injection 공격 기법 중에서도 가장 많이 사용되며, 대중적으로 잘 알려진 공격 기법이다. 1 2 3 SELECT * FROM users WHERE auth = &#39;admin&#39; AND id = &#39; id &#39; 서버에서 요청을 보낸 사용자가 관리자 권한이 있는지 확인하기 위와 같은 sql문으로 확인한다고 했을 때, 권한이 admin이고 올바른 id값을 가진 사용자가 있는지 조회해 결과가 나온다면 관리자로 인정받는다. 그러나 id의 인자로 아래와 같이 삽입 된다면, 1 &#39; OR &#39;1&#39; = &#39;1 싱글쿼터와 OR 1=1 라는 구문이 WHERE절을 모두 참으로 만들어 사실상 무조건적인 admin권한을 획득하는 것 이다. 이 뿐만 아니라 1 2 3 SELECT * FROM users WHERE auth = &#39;admin&#39; AND id = &#39;&#39;; DROP TABLE users; --&#39; ’; 으로 마무리 하고, DROP TABLE users; 새구문으로 사용자 테이블을 삭제하고 – 뒷 내용을 주석 처리한다면 사용자 테이블을 전체 삭제하는 구문으로 서버 자체를 운영하지 못하게 할 수도 있는 공격 기법이다. 2. Union based SQL Injection 원래의 요청에 추가 쿼리를 삽입하여 정보를 얻어내는 기법으로 2개 이상의 쿼리를 요청하여 결과를 얻는 Union 명령어를 이용여 공격으로 하나의 테이블로 결과를 얻는다. 단, Union 하는 두 테이블의 컬럼 수가 같아야 하고, 데이터 형이 같아야 한다. 다음과 같은 게시글 검색 쿼리문에서 1 2 SELECT * FROM Board WHERE title LIKE &#39;%INPUT%&#39; OR contents &#39;%INPUT%&#39; INPUT 안에 1 &#39;UNION SELECT null,id,password FROM Users-- 를 넣어주게 되면 두 쿼리문이 합쳐져 하나의 테이블로 보여지게 된다. 즉, Board 테이블의 id, password가 게시글과 함께 화면에 나타난다. 3. Blind based SQL Injection DB로부터 특정 데이터 전달받지 않고 즉, 정보를 직접적으로 알 수 없는 상황이더라도 참과 거짓 정보만을 통해 알아내는 기법이다. 웹 서버 보안으로 인해 기존 SQL Injection 공격 기법을 통한 정보가 출력되지 않는 경우 해당 기법을 시도할 수 있다. 4. Stored Procedure based SQL Injection 일련의 쿼리들을 모아 하나의 함수처럼 사용하기 위한 기법으로 공격자는 시스템 권한을 획득 해야 하는 공격난이도가 높은 공격이지만 공격에 성공한다면, 서버에 직접적인 피해를 가할 수 있다. 공격에 사용되는 대표적인 저장 프로시저는 MS-SQL 에 있는 xp_cmdshell로 윈도우 명령어를 사용할 수 있게 된다. 4. SQL Injection 대응방안 입력값 검증 화이트리스트 방식으로 지정된 형식의 문자만 검증한다. 특수문자 등의 에러 발생 유무 확인한다. db_name()으로 DB명 추출 여부 확인한다. SQL 오류 발생시 에러 메세지 표시하지 않기 별도로 처리해주지 않을 경우 에러가 발생한 쿼리문과 함께 에러에 관한 내용을 반환한다. (이 때 테이블 명, 컬럼명, 쿼리문이 노출 될 수 있기 때문에 메세지가 표시되지 않도록 처리해 주어야 한다.) 서버 보안 최소 권한 유저로 DB를 운영한다. 목적에 따라 쿼리 권한을 수정한다. 지속적인 관리를 통해 신뢰할 수 있는 네트워크, 서버에 대해서만 접근 허용한다. 웹 방화벽을 사용한다. 5. SQL Injection 이해하기 SQL Injection 공격을 이해하기 위한 간단한 실습을 진행해보자 운영 체제는 kali linux이며, 웹 모의 해킹 실습 서버 dvwa를 통해 실습하였다. user ID를 입력하는 창이 존재한다. 1을 입력하였더니 ID가 1인 사용자의 정보가 출력되었다. 소스를 확인해보면 이 소스코드의 경우 user ID에 사용자가 입력한 값이 $id라는 변수로 들어가기 때문에 직접 입력한 값으로 인해 sql 쿼리 문이 바뀌기 때문에 이는 sql 쿼리문을 조작할 수 있다는 의미이다. 위와 같이 입력하니 테이블의 모든 정보가 출력되었다. 이는 조건문이 항상 참이 되도록 입력됐기 때문이다. 다음으로 Union을 사용해보자면 위에서 설명한 것과 같이 Union은 두 테이블의 컬럼 수가 같아야 하기 때문에 컬럼 수를 확인해보기 위해 다음과 같이 입력해본다. select 뒤의 상수 값을 주게 되면 그것을 그대로 출력시킬 수 있다고 한다. 결과를 보니 컬럼의 수가 맞지 않다는 에러가 나왔다. 이렇게 select구문의 컬럼이 2개가 사용되었다는 것을 알 수 있다고 한다. 이제 DB정보를 알아보자면 1’union select schema_name,1 from information_schema.schemata # DB명 조회와 관련된 구문이다. 다음과 같이 모든 DB이름을 확인 할 수 있다. 6. 참고 https://noirstar.tistory.com/264 https://doh-an.tistory.com/27 버그잡는해커 유튜브","headline":"SQL Injection","mainEntityOfPage":{"@type":"WebPage","@id":"https://teamscp.github.io/posts/SQL-injection/"},"url":"https://teamscp.github.io/posts/SQL-injection/"}</script><title>SQL Injection | SCP Tech Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="mask-icon" href="/assets/img/favicons/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/favicons/SCP_%EB%9D%BC%EC%9D%B83-big.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">SCP Tech Blog</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/TeamSCP" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.facebook.com/HackingTeamSCP" aria-label="facebook" target="_blank" rel="noopener"> <i class="fab fa-facebook"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>SQL Injection </span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>SQL Injection</h1><div class="post-meta text-muted"><div> By <em> 이정호 </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1661644800" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-08-28 </em> </span> <span> Updated <em class="timeago" data-ts="1661644800" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-08-28 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1533 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><h1 id="sql-injection">SQL Injection</h1><h1 id="1-sql-injection-공격이란">1. SQL Injection 공격이란?</h1><p>SQL: DB에 명령 내릴 때 쓰는 언어<br /> Injection: 삽입<br /> 임의의 SQL문을 삽입하고 실행시켜 데이터 베이스가 비정상적인 동작을 하도록 조작하는 행위이다.</p><hr /><p><br /></p><h1 id="2-sql-injection-공격의-목적">2. SQL Injection 공격의 목적</h1><h4 id="1-db에-임의의-sql명령-실행"><span class="mr-2">1. DB에 임의의 SQL명령 실행</span><a href="#1-db에-임의의-sql명령-실행" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><h4 id="2-db의-데이터를-추출"><span class="mr-2">2. DB의 데이터를 추출</span><a href="#2-db의-데이터를-추출" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><h4 id="3-인증-우회"><span class="mr-2">3. 인증 우회</span><a href="#3-인증-우회" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><h4 id="4-db-데이터-변조"><span class="mr-2">4. DB 데이터 변조</span><a href="#4-db-데이터-변조" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><h4 id="5-악성-파일-업로드"><span class="mr-2">5. 악성 파일 업로드</span><a href="#5-악성-파일-업로드" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></h4><hr /><p><br /></p><h1 id="3-sql-injection-공격의-종류">3. SQL Injection 공격의 종류</h1><h3 id="1-error-based-sql-injection"><span class="mr-2">1. Error based SQL Injection</span><a href="#1-error-based-sql-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>다양한 SQL Injection 공격 기법 중에서도 가장 많이 사용되며, 대중적으로 잘 알려진 공격 기법이다.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>SELECT * FROM users
	WHERE auth = 'admin'
	AND id = ' id '
</pre></table></code></div></div><p>서버에서 요청을 보낸 사용자가 관리자 권한이 있는지 확인하기 위와 같은 sql문으로 확인한다고 했을 때, 권한이 admin이고 올바른 id값을 가진 사용자가 있는지 조회해 결과가 나온다면 관리자로 인정받는다. <br /> 그러나 id의 인자로 아래와 같이 삽입 된다면,</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>' OR '1' = '1
</pre></table></code></div></div><p>싱글쿼터와 OR 1=1 라는 구문이 WHERE절을 모두 참으로 만들어 사실상 무조건적인 admin권한을 획득하는 것 이다. 이 뿐만 아니라</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>SELECT * FROM users
	WHERE auth = 'admin'
	AND id = ''; DROP TABLE users; --'   
</pre></table></code></div></div><p><span style="color:red">’;</span> 으로 마무리 하고, <span style="color:red">DROP TABLE users;</span> 새구문으로 사용자 테이블을 삭제하고 <span style="color:red">–</span> 뒷 내용을 주석 처리한다면 사용자 테이블을 전체 삭제하는 구문으로 서버 자체를 운영하지 못하게 할 수도 있는 공격 기법이다.</p><hr /><h3 id="2-union-based-sql-injection"><span class="mr-2">2. Union based SQL Injection</span><a href="#2-union-based-sql-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>원래의 요청에 추가 쿼리를 삽입하여 정보를 얻어내는 기법으로 2개 이상의 쿼리를 요청하여 결과를 얻는 Union 명령어를 이용여 공격으로 하나의 테이블로 결과를 얻는다.<br /> 단, Union 하는 두 테이블의 컬럼 수가 같아야 하고, 데이터 형이 같아야 한다.</p><p>다음과 같은 게시글 검색 쿼리문에서</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>SELECT * FROM Board 
	WHERE title LIKE '%INPUT%' OR contents '%INPUT%'
</pre></table></code></div></div><p>INPUT 안에</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>'UNION SELECT null,id,password FROM Users--    
</pre></table></code></div></div><p>를 넣어주게 되면 두 쿼리문이 합쳐져 하나의 테이블로 보여지게 된다. 즉, Board 테이블의 id, password가 게시글과 함께 화면에 나타난다.</p><hr /><h3 id="3-blind-based-sql-injection"><span class="mr-2">3. Blind based SQL Injection</span><a href="#3-blind-based-sql-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>DB로부터 특정 데이터 전달받지 않고 즉, 정보를 직접적으로 알 수 없는 상황이더라도 참과 거짓 정보만을 통해 알아내는 기법이다. 웹 서버 보안으로 인해 기존 SQL Injection 공격 기법을 통한 정보가 출력되지 않는 경우 해당 기법을 시도할 수 있다.</p><hr /><h3 id="4-stored-procedure-based-sql-injection"><span class="mr-2">4. Stored Procedure based SQL Injection</span><a href="#4-stored-procedure-based-sql-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>일련의 쿼리들을 모아 하나의 함수처럼 사용하기 위한 기법으로 공격자는 시스템 권한을 획득 해야 하는 공격난이도가 높은 공격이지만 공격에 성공한다면, 서버에 직접적인 피해를 가할 수 있다. 공격에 사용되는 대표적인 저장 프로시저는 MS-SQL 에 있는 xp_cmdshell로 윈도우 명령어를 사용할 수 있게 된다.</p><hr /><p><br /></p><h1 id="4-sql-injection-대응방안">4. SQL Injection 대응방안</h1><ul><li>입력값 검증<ul><li>화이트리스트 방식으로 지정된 형식의 문자만 검증한다.<li>특수문자 등의 에러 발생 유무 확인한다.<li>db_name()으로 DB명 추출 여부 확인한다.</ul><p><br /></p><li>SQL 오류 발생시 에러 메세지 표시하지 않기<ul><li>별도로 처리해주지 않을 경우 에러가 발생한 쿼리문과 함께 에러에 관한 내용을 반환한다. <br /> (이 때 테이블 명, 컬럼명, 쿼리문이 노출 될 수 있기 때문에 메세지가 표시되지 않도록 처리해 주어야 한다.)<br /> <br /></ul><li>서버 보안<ul><li>최소 권한 유저로 DB를 운영한다.<li>목적에 따라 쿼리 권한을 수정한다.<li>지속적인 관리를 통해 신뢰할 수 있는 네트워크, 서버에 대해서만 접근 허용한다.<li>웹 방화벽을 사용한다.</ul></ul><hr /><p><br /></p><h1 id="5-sql-injection-이해하기">5. SQL Injection 이해하기</h1><p>SQL Injection 공격을 이해하기 위한 간단한 실습을 진행해보자<br /> 운영 체제는 kali linux이며, 웹 모의 해킹 실습 서버 dvwa를 통해 실습하였다. <br /> <img data-src="https://user-images.githubusercontent.com/102301788/187028966-6c569fdc-9922-4aae-acb0-db6b717840b8.png" alt="스크린샷(677)" data-proofer-ignore> <br /> user ID를 입력하는 창이 존재한다. <br /> <br /> <br /> <img data-src="https://user-images.githubusercontent.com/102301788/187028981-a57cb4c3-bc6d-4eef-bf7b-a2c3743ff0d6.png" alt="스크린샷(679)" data-proofer-ignore><br /> <img data-src="https://user-images.githubusercontent.com/102301788/187028985-b79ebf8b-09c2-403e-ad88-d36281515c37.png" alt="스크린샷(672)" data-proofer-ignore> <br /> 1을 입력하였더니 ID가 1인 사용자의 정보가 출력되었다. <br /> <br /> 소스를 확인해보면 <br /> <img data-src="https://user-images.githubusercontent.com/102301788/187029208-95fc44f1-cf90-4c2f-adee-fe41a06040d4.png" alt="스크린샷(687)" data-proofer-ignore> <img data-src="https://user-images.githubusercontent.com/102301788/187029256-5fe03a93-ba42-4d5c-92bb-0e353478b4cd.png" alt="스크린샷(678)" data-proofer-ignore> <br /> 이 소스코드의 경우 user ID에 사용자가 입력한 값이 $id라는 변수로 들어가기 때문에 직접 입력한 값으로 인해 sql 쿼리 문이 바뀌기 때문에 이는 sql 쿼리문을 조작할 수 있다는 의미이다. <br /> <br /> <img data-src="https://user-images.githubusercontent.com/102301788/187029014-a2be982b-a021-4456-8c81-e3cac8a76cd0.png" alt="스크린샷(684)" data-proofer-ignore><br /> <img data-src="https://user-images.githubusercontent.com/102301788/187029016-94a548ec-c90e-4f8d-bd8c-297e1c1f1984.png" alt="스크린샷(685)" data-proofer-ignore> <br /> 위와 같이 입력하니 테이블의 모든 정보가 출력되었다. 이는 조건문이 항상 참이 되도록 입력됐기 때문이다. 다음으로 Union을 사용해보자면 위에서 설명한 것과 같이 Union은 두 테이블의 컬럼 수가 같아야 하기 때문에 컬럼 수를 확인해보기 위해 다음과 같이 입력해본다. <br /> <br /> <img data-src="https://user-images.githubusercontent.com/102301788/187029832-e51a942c-e774-49d6-b818-d6a0e66b2714.png" alt="스크린샷(690)" data-proofer-ignore> <br /> select 뒤의 상수 값을 주게 되면 그것을 그대로 출력시킬 수 있다고 한다. <br /><br /> <img data-src="https://user-images.githubusercontent.com/102301788/187029955-a04f9230-c044-474e-a61e-8dbd61eecd8b.png" alt="스크린샷(691)" data-proofer-ignore> <br /> 결과를 보니 컬럼의 수가 맞지 않다는 에러가 나왔다. <br /> <br /> <img data-src="https://user-images.githubusercontent.com/102301788/187030045-9e3b876b-a64b-47ff-9994-5383a4ecd622.png" alt="스크린샷(694)" data-proofer-ignore> <br /> <img data-src="https://user-images.githubusercontent.com/102301788/187030051-731fdf6b-6a6c-4250-aa6e-447e6a29be75.png" alt="스크린샷(695)" data-proofer-ignore> <br /> 이렇게 select구문의 컬럼이 2개가 사용되었다는 것을 알 수 있다고 한다. 이제 DB정보를 알아보자면 <br /> <br /> <img data-src="https://user-images.githubusercontent.com/102301788/187030394-29a70fad-9ee1-4552-8967-b5a8dfff31fe.png" alt="스크린샷(698)" data-proofer-ignore> <br /> 1’union select schema_name,1 from information_schema.schemata # DB명 조회와 관련된 구문이다. <br /> <br /> <img data-src="https://user-images.githubusercontent.com/102301788/187030406-832fbbc0-3d11-4fd7-9fe9-3a4aa197c9b6.png" alt="스크린샷(699)" data-proofer-ignore> <br /> 다음과 같이 모든 DB이름을 확인 할 수 있다.</p><p><br /></p><h1 id="6-참고">6. 참고</h1><p>https://noirstar.tistory.com/264 <br /> https://doh-an.tistory.com/27 <br /> 버그잡는해커 유튜브</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/web/'>Web</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/sql/" class="post-tag no-text-decoration" >SQL</a> <a href="/tags/sql-injection/" class="post-tag no-text-decoration" >SQL injection</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=SQL Injection - SCP Tech Blog&amp;url=https://teamscp.github.io/posts/SQL-injection/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=SQL Injection - SCP Tech Blog&amp;u=https://teamscp.github.io/posts/SQL-injection/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://teamscp.github.io/posts/SQL-injection/&amp;text=SQL Injection - SCP Tech Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/About_SCP/">About_SCP</a><li><a href="/posts/BruteForce/">Brute Force</a><li><a href="/posts/SQL-injection/">SQL Injection </a><li><a href="/posts/Stack_Frame/">스택(Stack)과 스택 프레임(Stack Frame)</a><li><a href="/posts/FSB/">FSB</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/apihooking/">APIHooking</a> <a class="post-tag" href="/tags/bcrypt/">Bcrypt</a> <a class="post-tag" href="/tags/bitcoin/">bitcoin</a> <a class="post-tag" href="/tags/blockchain/">blockchain</a> <a class="post-tag" href="/tags/brute-force/">Brute Force</a> <a class="post-tag" href="/tags/flask/">Flask</a> <a class="post-tag" href="/tags/fsb/">FSB</a> <a class="post-tag" href="/tags/hackrf/">HackRF</a> <a class="post-tag" href="/tags/jwt/">JWT</a> <a class="post-tag" href="/tags/promotion/">promotion</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Flask_Bcrypt_JWT/"><div class="card-body"> <em class="timeago small" data-ts="1661212800" > 2022-08-23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Flask] Bcrypt를 이용한 비밀번호 암호화 & JWT 인증 기반 로그인</h3><div class="text-muted small"><p> Bcrypt 비밀번호를 저장하는 목적으로 설계된 단방향 해시 함수이다. 단방향 해시 함수는 암호화는 가능하지만 복호화가 불가능하다. 회원가입 시 사용자가 입력한 비밀번호를 그대로 DB에 저장하는 것은 안전하지 않기 때문에 단방향 암호화를 거친 뒤 DB에 저장해야 한다. 암호화가 왜 필요할까? 사용자가 입력한 비밀번호가 DB에...</p></div></div></a></div><div class="card"> <a href="/posts/BruteForce/"><div class="card-body"> <em class="timeago small" data-ts="1663027200" > 2022-09-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Brute Force</h3><div class="text-muted small"><p> Brute Force 이란? 영어로 Brute 는 “짐승 같은,난폭한”이라는 뜻이고, Brute Force는 “난폭한 힘,폭력”이라는 뜻으로 조합 가능한 모든 문자열을 하나씩 대입하여 암호를 해독하는 방법이다. Brute Force 장점 이론적으로 가능한 모든 경우의 수를 다 검색해 보는 것이라 정확도 100%가 항상 보장된다. 또한 브루트 포스의...</p></div></div></a></div><div class="card"> <a href="/posts/About_SCP/"><div class="card-body"> <em class="timeago small" data-ts="1662422400" > 2022-09-06 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>About_SCP</h3><div class="text-muted small"><p> About_SCP 소개말 중부대학교 SCP 동아리는 정보보호학과 유승재 교수님의 지도하의 정보보호 연구 동아리입니다. 1998년 정보보호 창업 동아리 Soul Magic으로 창설해, 2005년 Security Check Point의 약자인 S.C.P로 바꾸어 활동하고 있습니다. S.C.P는 중부대학교 고양캠퍼스 세종관 804호에 위치하고 있으며 동...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/FSB/" class="btn btn-outline-primary" prompt="Older"><p>FSB</p></a> <a href="/posts/Stack_Frame/" class="btn btn-outline-primary" prompt="Newer"><p>스택(Stack)과 스택 프레임(Stack Frame)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2023 <a href="">SCP</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/apihooking/">APIHooking</a> <a class="post-tag" href="/tags/bcrypt/">Bcrypt</a> <a class="post-tag" href="/tags/bitcoin/">bitcoin</a> <a class="post-tag" href="/tags/blockchain/">blockchain</a> <a class="post-tag" href="/tags/brute-force/">Brute Force</a> <a class="post-tag" href="/tags/flask/">Flask</a> <a class="post-tag" href="/tags/fsb/">FSB</a> <a class="post-tag" href="/tags/hackrf/">HackRF</a> <a class="post-tag" href="/tags/jwt/">JWT</a> <a class="post-tag" href="/tags/promotion/">promotion</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
